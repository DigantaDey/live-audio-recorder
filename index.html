<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Audio Recorder with Real-time Monitoring</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="bg-white p-8 rounded shadow-md w-full max-w-sm">
        <h1 class="text-2xl font-bold mb-4">Audio Recorder</h1>
        <div class="flex justify-between mb-4">
            <button id="record" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Record</button>
            <button id="pause" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600" disabled>Pause</button>
            <button id="resume" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600" disabled>Resume</button>
            <button id="stop" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600" disabled>Stop</button>
        </div>
        <div class="flex justify-between mb-4">
            <button id="play" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600" disabled>Play</button>
            <button id="save" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600" disabled>Save</button>
        </div>
        <audio id="audioPlayback" class="w-full" controls></audio>
        <div id="status" class="text-center mt-4"></div>
    </div>

    <script>
        let mediaRecorder;
        let audioChunks = [];
        let audioURL;
        let audioContext;
        let source;
        let gainNode;
        let destination;
        let playbackStream;
        let playbackAudio;
        let startTime;
        let timerInterval;

        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }

        function updateDuration() {
            const duration = Math.floor((Date.now() - startTime) / 1000);
            updateStatus(`Recording Duration: ${duration}s`);
        }

        document.getElementById('record').addEventListener('click', async () => {
            const stream = await navigator.mediaDevices.getUserMedia({
                audio: {
                    sampleRate: 44100,
                    channelCount: 2,
                    echoCancellation: true,
                    noiseSuppression: true,
                    autoGainControl: true
                }
            });

            mediaRecorder = new MediaRecorder(stream);

            audioContext = new AudioContext();
            source = audioContext.createMediaStreamSource(stream);
            gainNode = audioContext.createGain();
            gainNode.gain.value = 1; // Set gain to 1 for better audio quality
            destination = audioContext.createMediaStreamDestination();
            source.connect(gainNode).connect(destination);

            playbackStream = new Audio();
            playbackStream.srcObject = destination.stream;
            playbackStream.play();

            mediaRecorder.ondataavailable = event => audioChunks.push(event.data);
            mediaRecorder.start();

            startTime = Date.now();
            timerInterval = setInterval(updateDuration, 1000);

            document.getElementById('record').disabled = true;
            document.getElementById('pause').disabled = false;
            document.getElementById('stop').disabled = false;
            updateStatus('Recording...');
        });

        document.getElementById('pause').addEventListener('click', () => {
            if (mediaRecorder.state === 'recording') {
                mediaRecorder.pause();
                playbackStream.pause();
                clearInterval(timerInterval);
                document.getElementById('pause').disabled = true;
                document.getElementById('resume').disabled = false;
                updateStatus('Recording Paused');
            }
        });

        document.getElementById('resume').addEventListener('click', () => {
            if (mediaRecorder.state === 'paused') {
                mediaRecorder.resume();
                playbackStream.play();
                startTime = Date.now();
                timerInterval = setInterval(updateDuration, 1000);
                document.getElementById('pause').disabled = false;
                document.getElementById('resume').disabled = true;
                updateStatus('Recording...');
            }
        });

        document.getElementById('stop').addEventListener('click', () => {
            mediaRecorder.stop();
            mediaRecorder.onstop = () => {
                clearInterval(timerInterval);
                const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                audioURL = URL.createObjectURL(audioBlob);
                document.getElementById('audioPlayback').src = audioURL;
                audioChunks = [];

                document.getElementById('play').disabled = false;
                document.getElementById('save').disabled = false;
                updateStatus('Recording Stopped');
            };

            document.getElementById('record').disabled = false;
            document.getElementById('pause').disabled = true;
            document.getElementById('resume').disabled = true;
            document.getElementById('stop').disabled = true;

            playbackStream.pause();
            playbackStream.srcObject = null;
            source.disconnect(gainNode);
            gainNode.disconnect(destination);
            audioContext.close();
        });

        document.getElementById('play').addEventListener('click', () => {
            if (document.getElementById('play').textContent === 'Play') {
                if (playbackAudio) {
                    playbackAudio.pause();
                    playbackAudio.currentTime = 0;
                }

                playbackAudio = new Audio(audioURL);
                playbackAudio.play();
                document.getElementById('play').textContent = 'Pause Playing';
                document.getElementById('play').classList.replace('bg-purple-500', 'bg-orange-500');
                document.getElementById('play').classList.replace('hover:bg-purple-600', 'hover:bg-orange-600');

                playbackAudio.onended = () => {
                    document.getElementById('play').textContent = 'Play';
                    document.getElementById('play').classList.replace('bg-orange-500', 'bg-purple-500');
                    document.getElementById('play').classList.replace('hover:bg-orange-600', 'hover:bg-purple-600');
                    updateStatus('Playback Ended');
                };
                updateStatus('Playing...');
            } else {
                playbackAudio.pause();
                document.getElementById('play').textContent = 'Play';
                document.getElementById('play').classList.replace('bg-orange-500', 'bg-purple-500');
                document.getElementById('play').classList.replace('hover:bg-orange-600', 'hover:bg-purple-600');
                updateStatus('Playback Paused');
            }
        });

        document.getElementById('save').addEventListener('click', () => {
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = audioURL;
            a.download = 'recording.wav';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            updateStatus('Recording Saved');
        });
    </script>
</body>
</html>
